# EPGrab

Grab DVB EPG data from Linux DVB-T devices.

EPGrab tunes to each frequency in your channel list, reads EIT (Event Information Table) sections from the transport stream, and displays programme schedule information for all discovered services.

## Requirements

* Linux with DVB subsystem support
* A Linux-supported DVB-T receiver device (see [LinuxTV Hardware Database](https://www.linuxtv.org/wiki/index.php/Hardware_Device_Information))
* Rust toolchain (edition 2024)

## Build

```
cargo build --release
```

This produces a single binary `target/release/epgrab` with subcommands.

## Usage

### 1. Scan channels

First, scan for available channels using a DVB scan file. On Debian-based systems, scan files are provided by the `dtv-scan-tables` package.

```
cargo run --release -- scan-channels -C /usr/share/dvb/dvb-t/tw-All
```

This will:
* Tune to each frequency listed in the scan file
* Read PAT/SDT/PMT tables to discover services, channel names, and PIDs
* Write the results to `etc/channels.conf` in zap format

### 2. Grab EPG data

Once you have a `etc/channels.conf`, run the EPG grabber:

```
cargo run --release -- run
```

This will:
* Group channels by frequency (to avoid redundant tuning)
* Tune to each frequency and read EIT present/following data
* Display programme information (title, start time, duration, description) for each channel

## Project Structure

```
src/
  lib.rs           -- library crate, exposes shared modules
  main.rs          -- epgrab binary: subcommand dispatch (run, scan-channels)
  channel.rs       -- channels.conf parser (zap format)
  dvb_device.rs    -- DVB USB device detection via sysfs
  tuner.rs         -- DVB frontend tuning (DVB v5 API)
  eit.rs           -- EIT section reading & parsing
  scan.rs          -- channel scanning (PAT/SDT/PMT parsing)
etc/
  channels.conf    -- discovered channels (generated by scan-channels)
doc/
  concept.md       -- DVB EPG concepts and table structures
  references.md    -- specifications, tools, and related projects
```

## Acknowledgments

This project was heavily inspired by and draws conceptual guidance from [tv_grab_dvb](https://bryars.eu/projects/tv_grab_dvb/).

## License

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
